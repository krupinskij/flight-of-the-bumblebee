<!DOCTYPE html>
<html>

<head>
    <title> Flight Of The Bumblebee </title>

    <link rel="stylesheet" href="css/canvas.css">

    <script type='text/javascript' src='js/helpers/gl-matrix-min.js'></script>
    <script type='text/javascript' src='js/helpers/canvas.js'></script>

    <script type='text/javascript' src='js/Bumblebee.js'></script>
    <script type='text/javascript' src='js/Camera.js'></script>
    <script type='text/javascript' src='js/Utils.js'></script>
    <script type='text/javascript' src='js/Scene.js'></script>
    <script type='text/javascript' src='js/Program.js'></script>

</head>

<body>
    <canvas id="canvas-element-id" width="1000" height="600">
        Your browser does not support HTML5
    </canvas>

    <script id="phong/shader-fs" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision highp float;
        #endif
        
        uniform float uShininess;        //shininess
        uniform vec3 uLightDirection;  //light direction
        
        uniform vec4 uMaterialAmbient;  //object ambient property
        uniform vec4 uMaterialDiffuse;   //object diffuse property
        uniform vec4 uMaterialSpecular;  //object specular property
        
        varying vec3 n;
        varying vec3 v;
        
        void main(void)
        {
             vec3 L = normalize(uLightDirection-v);
             vec3 N = normalize(n);
             
             float lambertTerm = dot(N,L);

             vec4 Ia = vec4(0.0, 0.0, 0.0, 1.0) * uMaterialAmbient;
             vec4 Id = vec4(0.0,0.0,0.0,1.0);
             vec4 Is = vec4(0.0,0.0,0.0,1.0);
             
             if(lambertTerm > 0.0)
             {
                  Id = uMaterialDiffuse * lambertTerm;
                  
                  vec3 V = normalize(-v);
                  vec3 R = reflect(-L, N);
                  float specular = pow( max(dot(R, V), 0.0), uShininess);
                  
                  Is = uMaterialSpecular * specular;
             }
             
             vec4 finalColor = Ia + Id + Is;
             finalColor.a = 1.0;
             
             gl_FragColor = finalColor;
        }
        </script>

    <script id="phong/shader-vs" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;        

        uniform mat4 uModelMatrix;
        uniform mat4 uViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform mat4 uNormalMatrix;
        
        varying vec3 n;
        varying vec3 v;
        
        void main(void) {

             vec4 vertex = uViewMatrix  * uModelMatrix * vec4(aVertexPosition, 1.0);
             
             n = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));
             v = vec3(vertex.xyz);
             
             gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);
        }
        </script>

    <script id='gouraud/shader-fs' type='x-shader/x-fragment'>
        #ifdef GL_ES
        precision highp float;
        #endif

        varying vec4 color;

        void main(void)
        {
            gl_FragColor = color;
        }
    </script>

    <script id='gouraud/shader-vs' type='x-shader/x-vertex'>
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;
        
        uniform mat4 uModelMatrix;
        uniform mat4 uViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform mat4 uNormalMatrix;
        
        uniform float uShininess;   //shininness
        uniform vec3 uLightDirection;  //light direction
        
        uniform vec4 uMaterialAmbient;  //object ambient property
        uniform vec4 uMaterialDiffuse;   //object diffuse property
        uniform vec4 uMaterialSpecular;  //object specular property
        
        varying vec4 color;
 
        void main(void) {
        
            vec4 vertex = uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);
            vec3 N = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));
            vec3 L = normalize(uLightDirection - vec3(vertex)); 
            
            float lambertTerm = dot(N,L);
            
            vec4 Ia = vec4(0.0,0.0,0.0,1.0) * uMaterialAmbient;
            vec4 Id = vec4(0.0,0.0,0.0,1.0);
            vec4 Is = vec4(0.0,0.0,0.0,1.0);
            
            if(lambertTerm > 0.0) //only if lambertTerm is positive
            {
                Id = uMaterialDiffuse * lambertTerm;
                
                vec3 V = normalize(-vertex.xyz);
                vec3 R = reflect(L, N);
                float specular = pow(max(dot(R, V), 0.0), uShininess );
                
                Is = uMaterialSpecular * specular;
            }

            color = Ia + Id + Is;
            color.a = 1.0;

            gl_Position = uProjectionMatrix * vertex;
        }
    </script>


    <script type='text/javascript' src='js/WebGLApp.js'></script>
    </body>

</html>