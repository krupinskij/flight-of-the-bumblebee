<!DOCTYPE html>
<html>

<head>
    <title> Flight Of The Bumblebee </title>

    <link rel="stylesheet" href="css/canvas.css">

    <script type='text/javascript' src='js/helpers/gl-matrix-min.js'></script>
    <script type='text/javascript' src='js/helpers/canvas.js'></script>

    <script type='text/javascript' src='js/Bumblebee.js'></script>
    <script type='text/javascript' src='js/Weather.js'></script>
    <script type='text/javascript' src='js/Camera.js'></script>
    <script type='text/javascript' src='js/Utils.js'></script>
    <script type='text/javascript' src='js/Scene.js'></script>
    <script type='text/javascript' src='js/Program.js'></script>

</head>

<body>
    <canvas id="canvas-element-id" width="1000" height="600">
        Your browser does not support HTML5
    </canvas>

    <script id="phong/shader-vs" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;        

        uniform mat4 uModelMatrix;
        uniform mat4 uViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform mat4 uNormalMatrix;

        uniform vec3 uLightWorldPosition;
        uniform vec3 uViewWorldPosition;

        varying vec3 n;
        varying vec3 v;
        varying float f;
        varying vec3 sl;
        varying vec3 sv;
        
        void main(void) {

             vec4 vertex = uViewMatrix  * uModelMatrix * vec4(aVertexPosition, 1.0);
             vec3 surfaceWorldPosition = vec3( uModelMatrix * vec4(aVertexPosition, 1.0));
             
             n = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));
             v = vec3(vertex.xyz);
             f = -vertex.z;
             sl = uLightWorldPosition - surfaceWorldPosition;
             sv = uViewWorldPosition - surfaceWorldPosition;
             
             gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);
        }
    </script>

    <script id="phong/shader-fs" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision highp float;
        #endif
        
        uniform float uShininess;        //shininess
        uniform vec3 uLightDirection;
        
        uniform vec4 uMaterialAmbient;
        uniform vec4 uMaterialDiffuse;
        uniform vec4 uMaterialSpecular;
        
        varying vec3 n;
        varying vec3 v;
        varying float f;
        varying vec3 sl;
        varying vec3 sv;

        uniform float uFogNear;
        uniform float uFogFar;
        uniform vec4 uFogColor;
        uniform float uLightness;

        uniform bool uBlinnModel;
        
        void main(void)
        {

            vec3 N = normalize(n);
            vec3 SL = normalize(sl);
            vec3 SV = normalize(sv);
            vec3 HV = normalize(SL + SV);
            
            float light = 0.0;
            float specular = 0.0;
                
            light = dot(N, SL);
            if (light > 0.0) {
                if(dot(N, HV)>0.0) specular = pow(dot(N, HV), 150.0);
            }

            vec4 finalColor = vec4(0.0, 0.0, 0.0, 1.0);
             
            vec3 L = normalize(uLightDirection-v);
            vec3 V = normalize(-v);
            vec3 R = reflect(-L, N);
            vec3 H = normalize(L + V);

            float lambertTerm = dot(L, N);

            vec4 Ia = vec4(1.0, 1.0, 1.0, 1.0) * uMaterialAmbient;
            vec4 Id = vec4(0.0,0.0,0.0,1.0);
            vec4 Is = vec4(0.0,0.0,0.0,1.0);

            if(lambertTerm > 0.0)
            {
                Id = uMaterialDiffuse * lambertTerm;
                
                if(uBlinnModel) Is = uMaterialSpecular * pow(max(dot(N, H), 0.0), uShininess);
                else Is = uMaterialSpecular * pow(max(dot(R, V), 0.0), uShininess);
            }
             
            finalColor = Ia + uLightness * Id + uLightness *Is;

            finalColor += vec4(0.0, 0.0, 0.0, 1.0) * light + specular;
            
            finalColor.a = 1.0;
 
            float fogAmount = smoothstep(uFogNear, uFogFar, length(v));
            gl_FragColor = mix(finalColor, uFogColor, fogAmount);
        }
        </script>

    

    <script id='gouraud/shader-fs' type='x-shader/x-fragment'>
        #ifdef GL_ES
        precision highp float;
        #endif

        varying vec4 color;

        void main(void)
        {
            gl_FragColor = color;
        }
    </script>

    <script id='gouraud/shader-vs' type='x-shader/x-vertex'>
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;
        
        uniform mat4 uModelMatrix;
        uniform mat4 uViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform mat4 uNormalMatrix;
        
        uniform float uShininess;   //shininness
        uniform vec3 uLightDirection;  //light direction

        uniform vec3 uLightWorldPosition;
        uniform vec3 uViewWorldPosition;
        
        uniform vec4 uMaterialAmbient;  //object ambient property
        uniform vec4 uMaterialDiffuse;   //object diffuse property
        uniform vec4 uMaterialSpecular;  //object specular property
        
        varying vec4 color;

        uniform float uFogNear;
        uniform float uFogFar;
        uniform vec4 uFogColor;
        uniform float uLightness;

        uniform bool uBlinnModel;
 
        void main(void) {
        
            vec4 vertex = uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);
            vec3 surfaceWorldPosition = vec3( uModelMatrix * vec4(aVertexPosition, 1.0));
            
            vec3 N = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));
            color = vec4(0.0, 0.0, 0.0, 1.0);

            vec3 L = normalize(uLightDirection - vec3(vertex)); 
            vec3 V = normalize(-vec3(vertex));
            vec3 R = reflect(-L, N);
            vec3 H = normalize(L + V);

            vec3 SL = normalize(uLightWorldPosition - surfaceWorldPosition);
            vec3 SV = normalize(uViewWorldPosition - surfaceWorldPosition);
            vec3 HV = normalize(SL + SV);
            float light = 0.0;
            float specular = 0.0;
                
            light = dot(N, SL);
            if (light > 0.0) {
                if(dot(N, HV)>0.0) specular = pow(dot(N, HV), 150.0);
            }

            float lambertTerm = dot(L, N);

            vec4 Ia = vec4(0.0, 0.0, 0.0, 1.0) * uMaterialAmbient;
            vec4 Id = vec4(0.0,0.0,0.0,1.0);
            vec4 Is = vec4(0.0,0.0,0.0,1.0);

            if(lambertTerm > 0.0)
            {
                Id = uMaterialDiffuse * lambertTerm;
                
                if(uBlinnModel) Is = uMaterialSpecular * pow(max(dot(N, H), 0.0), uShininess);
                else Is = uMaterialSpecular * pow(max(dot(R, V), 0.0), uShininess);
            }

            color = Ia + uLightness * Id + Is;
            color += vec4(0.0, 0.0, 0.0, 1.0) * light + specular;
            color.a = 1.0;

            float fogAmount = smoothstep(uFogNear, uFogFar, length(vertex));
            color = mix(color, uFogColor, fogAmount);

            gl_Position = uProjectionMatrix * vertex;
        }
    </script>


    <script type='text/javascript' src='js/WebGLApp.js'></script>
    </body>

</html>